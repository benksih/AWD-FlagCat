<template>
  <div class="exploits-container">
    <h4>攻击脚本 (Payload)</h4>
    <p>当前选用: <el-tag type="success" size="small">{{ config.selected_exploit }}</el-tag></p>
    
    <el-radio-group 
      v-model="config.selected_exploit" 
      @change="updateSelectedExploit" 
      class="exploit-list"
    >
      <el-radio v-for="exp in exploitList" :key="exp" :label="exp" border>
        {{ exp }}
      </el-radio>
    </el-radio-group>

    <el-upload
      drag
      action="http://1227.0.0.1:8000/api/exploits/upload"
      :on-success="handleUploadSuccess"
      :on-error="handleUploadError"
      accept=".py"
      class="exploit-uploader"
    >
      <el-icon class="el-icon--upload"><i-ep-upload-filled /></el-icon>
      <div class="el-upload__text">
        将新 .py 脚本拖到此处，或 <em>点击上传</em>
      </div>
    </el-upload>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useConfigStore } from '../store/configStore';
// ... 其他 import ...

const configStore = useConfigStore();
const { config } = storeToRefs(configStore);

const exploitList = ref<string[]>([]);
const fetchExploits = async () => { /* ... 获取列表逻辑不变 ... */ };

onMounted(fetchExploits);

const handleUploadSuccess = () => { /* ... 上传成功逻辑不变 ... */ };
const handleUploadError = () => { /* ... 上传失败逻辑不变 ... */ };

// 当用户选择新脚本时，直接修改store中的值并保存
const updateSelectedExploit = () => {
  configStore.saveConfig();
};
</script>

<style scoped>
.exploit-list {
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 10px;
}
.page-container { padding: 20px; }
</style>